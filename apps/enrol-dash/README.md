# Enrolment Database Schema Documentation

This README provides an overview of the tables in the enrolment module, along with their fields and functions.

## Tables

### Table: enrol **

This table stores instances of enrolment plugins used in courses.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **cost**: VARCHAR(20), Optional, Custom - enrolment cost.
- **course_id**: BIGINT(19), Nullable.
- **currency**: VARCHAR(3), Optional, Custom - cost currency.
- **custom_char1**: VARCHAR(255), Optional, Custom - general short name.
- **custom_char2**: VARCHAR(255), Optional, Custom - general short name.
- **custom_char3**: VARCHAR(1333), Optional, Custom - general short name.
- **custom_dec1**: DECIMAL(12), Optional, Custom - general decimal.
- **custom_dec2**: DECIMAL(12), Optional, Custom - general decimal.
- **custom_int1**: BIGINT(19), Optional, Custom - general int.
- **custom_int2**: BIGINT(19), Optional, Custom - general int.
- **custom_int3**: BIGINT(19), Optional, Custom - general int.
- **custom_int4**: BIGINT(19), Optional, Custom - general int.
- **custom_int5**: BIGINT(19), Optional, Custom - general int.
- **custom_int6**: BIGINT(19), Optional, Custom - general int.
- **custom_int7**: BIGINT(19), Optional, Custom - general int.
- **custom_int8**: BIGINT(19), Optional, Custom - general int.
- **custom_text1**: LONGTEXT(2147483647), Optional, Custom - general text.
- **custom_text2**: LONGTEXT(2147483647), Optional, Custom - general text.
- **custom_text3**: LONGTEXT(2147483647), Optional, Custom - general text.
- **custom_text4**: LONGTEXT(2147483647), Optional, Custom - general text.
- **enrol**: VARCHAR(20), Mandatory.
- **enrol_end_date**: BIGINT(19), Optional, Custom - end of enrolment.
- **enrol_period**: BIGINT(19), Optional, Custom - enrolment duration.
- **enrol_start_date**: BIGINT(19), Optional, Custom - start of self-enrolment.
- **expiry_notify**: BIT(1), Optional, Custom - notify users before expiration.
- **expiry_threshold**: BIGINT(19), Optional, Custom - when should the participants be notified.
- **name**: VARCHAR(255), Optional, Nullable, Optional instance name.
- **notify_all**: BIT(1), Optional, Custom - Notify both participant and person responsible for enrolments.
- **password**: VARCHAR(50), Optional, Custom - enrolment or access password.
- **role_id**: BIGINT(19), Optional, Custom - the default role given to participants who self-enrol.
- **sort_order**: BIGINT(19), Default 0, Order of enrol plugins in each course.
- **status**: BIGINT(19), Default 0, 0 means active enrolment, see ENROL*STATUS*\* constants, plugins may define own status greater than 10.
- **time_created**: BIGINT(19), Default 0.
- **time_modified**: BIGINT(19), Default 0.

### Table: enrol_flatfile **

This table stores enrol_flatfile data.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **action**: VARCHAR(30), Mandatory.
- **course_id**: BIGINT(19), Nullable.
- **role_id**: BIGINT(19), Nullable.
- **time_end**: BIGINT(19), Default 0.
- **time_modified**: BIGINT(19), Default 0.
- **time_start**: BIGINT(19), Default 0.
- **user_id**: BIGINT(19), Nullable.

### Table: enrol_lti_app_registration **

This table stores details of each application that has been registered with the LTI (Learning Tools Interoperability) system.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **access_token_url**: LONGTEXT(2147483647), Optional.
- **authentication_request_url**: LONGTEXT(2147483647), Optional, The authorisation endpoint of the platform.
- **client_id**: VARCHAR(1333), Optional, The client_id string, generated by the platform when setting up the tool.
- **jwks_url**: LONGTEXT(2147483647), Optional, The JSON Web Key Set URL for the platform.
- **name**: VARCHAR(255), Mandatory, Common name to identify this platform to users.
- **platform_client_hash**: VARCHAR(64), Optional, SHA256 hash of the platform_id (issuer) and client_id.
- **platform_id**: LONGTEXT(2147483647), Optional, The issuer URL.
- **platform_unique_id_hash**: VARCHAR(64), Optional, SHA256 hash of the platform_id (issuer) and unique_id.
- **status**: BIT(1), Default 0, Status of the registration, used to denote draft (incomplete) or active (complete).
- **time_created**: BIGINT(19), Nullable.
- **time_modified**: BIGINT(19), Nullable.
- **unique_id**: VARCHAR(255), Mandatory, A unique local id, which can be used in the initiate login URI to provide {iss, client_id} uniqueness in the absence of the optional client_id claim.

### Table: enrol_lti_context **

This table stores information about contexts in the LTI platform where resources are shared.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **context_id**: VARCHAR(255), Mandatory, The id of the context on the platform.
- **lti_deployment_id**: BIGINT(19), Nullable, The id of the enrol_lti_deployment record containing the deployment information.
- **time_created**: BIGINT(19), Nullable.
- **time_modified**: BIGINT(19), Nullable.
- **type**: LONGTEXT(2147483647), Optional, The type of the context on the platform.

### Table: enrol_lti_deployment **

This table stores information about tool deployments within a platform.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **deployment_id**: VARCHAR(255), Mandatory, The id of the deployment, as defined in the platform.
- **legacy_consumer_key**: VARCHAR(255), Optional, The legacy consumer key mapped to this deployment, if the deployment represents a migrated tool.
- **name**: VARCHAR(255), Mandatory, A short name identifying the tool deployment to users.
- **platform_id**: BIGINT(19), Nullable, The platform_id to which this deployment belongs.
- **time_created**: BIGINT(19), Nullable.
- **time_modified**: BIGINT(19), Nullable.

### Table: enrol_lti_lti2_consumer **

This table stores information about LTI consumers interacting with Moodle.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **consumer_guid**: VARCHAR(1024), Optional.
- **consumer_key**: LONGTEXT(2147483647), Optional.
- **consumer_key256**: VARCHAR(255), Mandatory.
- **consumer_name**: VARCHAR(255), Optional.
- **consumer_version**: VARCHAR(255), Optional.
- **enabled**: BIT(1), Nullable.
- **last_access**: BIGINT(19), Optional.
- **lti_version**: VARCHAR(10), Optional.
- **name**: VARCHAR(50), Mandatory.
- **profile**: LONGTEXT(2147483647), Optional.
- **protected**: BIT(1), Nullable.
- **secret**: VARCHAR(1024), Mandatory.
- **settings**: LONGTEXT(2147483647), Optional.
- **tool_proxy**: LONGTEXT(2147483647), Optional.
- **enable_from**: BIGINT(19), Optional.
- **enable_until**: BIGINT(19), Optional.
- **created**: BIGINT(19), Nullable.
- **updated**: BIGINT(19), Nullable.

### Table: enrol_lti_lti2_context **

This table stores information about specific LTI contexts from the consumers.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **consumer_id**: BIGINT(19), Nullable.
- **lti_context_key**: VARCHAR(255), Mandatory.
- **settings**: LONGTEXT(2147483647), Optional.
- **type**: VARCHAR(100), Optional.
- **created**: BIGINT(19), Nullable.
- **updated**: BIGINT(19), Nullable.

### Table: enrol_lti_lti2_nonce **

This table stores nonce used for authentication between Moodle and a consumer.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **consumer_id**: BIGINT(19), Nullable.
- **expires**: BIGINT(19), Nullable.
- **value**: VARCHAR(64), Mandatory.

### Table: enrol_lti_lti2_resource_link **

This table stores links from the consumer to the tool.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **consumer_id**: BIGINT(19), Optional.
- **context_id**: BIGINT(19), Optional.
- **lti_resource_link_key**: VARCHAR(255), Mandatory.
- **primary_resource_link_id**: BIGINT(19), Optional.
- **settings**: LONGTEXT(2147483647), Optional.
- **share_approved**: BIT(1), Optional.
- **created**: BIGINT(19), Nullable.
- **updated**: BIGINT(19), Nullable.

### Table: enrol_lti_lti2_share_key 

This table stores resource link share key.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **auto_approve**: BIT(1), Nullable.
- **expires**: BIGINT(19), Nullable.
- **resource_link_id**: BIGINT(19), Nullable.
- **share_key**: VARCHAR(32), Mandatory.

### Table: enrol_lti_lti2_tool_proxy

This table stores a tool proxy between Moodle and a consumer.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **consumer_id**: BIGINT(19), Nullable.
- **created**: BIGINT(19), Nullable.
- **tool_proxy**: LONGTEXT(2147483647), Mandatory.
- **tool_proxy_key**: VARCHAR(32), Mandatory.
- **updated**: BIGINT(19), Nullable.

### Table: enrol_lti_lti2_user_result

This table stores results for each user for each resource link.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **created**: BIGINT(19), Nullable.
- **lti_result_sourced_id**: VARCHAR(1024), Mandatory.
- **lti_user_key**: VARCHAR(255), Mandatory.
- **resource_link_id**: BIGINT(19), Nullable.
- **updated**: BIGINT(19), Nullable.

### Table: enrol_lti_resource_link

This table stores resource links for a platform and deployment.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **context_memberships_url**: VARCHAR(1333), Optional, The NRPS membership URL.
- **line_item_scope**: VARCHAR(255), Optional, The ags line items authorization scope.
- **line_item_service**: VARCHAR(1333), Optional, The URL for the line item service (if only one line item present).
- **line_items_service**: VARCHAR(1333), Optional, The URL for the line items service for this resource link.
- **lti_context_id**: BIGINT(19), Optional, The id of the enrol_lti_context record containing information about the context from which this resource link originates.
- **lti_deployment_id**: BIGINT(19), Nullable, The id of the enrol_lti_deployment record containing the deployment information.
- **nrps_service_versions**: VARCHAR(255), Optional, The NRPS supported service versions.
- **resource_id**: BIGINT(19), Nullable, The id of the local enrol_lti_tools record containing information about the published resource to which this resource link relates.
- **resource_link_id**: VARCHAR(255), Mandatory, The platform-and-deployment-unique id of the resource link.
- **result_scope**: VARCHAR(255), Optional, The ags result authorization scope.
- **score_scope**: VARCHAR(255), Optional, The ags score items authorization scope.
- **time_created**: BIGINT(19), Nullable.
- **time_modified**: BIGINT(19), Nullable.

### Table: enrol_lti_tool_consumer_map

This table maps the published tool to tool consumers.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **consumer_id**: BIGINT(19), Nullable, The consumer ID.
- **tool_id**: BIGINT(19), Nullable, The tool ID.

### Table: enrol_lti_tools

This table stores a list of tools provided to the remote system.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **city**: VARCHAR(120), Mandatory.
- **context_id**: BIGINT(19), Nullable.
- **country**: VARCHAR(2), Mandatory.
- **enrol_id**: BIGINT(19), Nullable.
- **grade_sync**: BIT(1), Default 0.
- **grade_sync_completion**: BIT(1), Default 0.
- **institution**: VARCHAR(40), Mandatory.
- **lang**: VARCHAR(30), Default 'en'.
- **lti_version**: VARCHAR(15), Default 'LTI-1p3'.
- **mail_display**: TINYINT(3), Default 2.
- **max_enrolled**: BIGINT(19), Default 0.
- **member_sync**: BIT(1), Default 0.
- **member_sync_mode**: BIT(1), Default 0.
- **provisioning_mode_instructor**: TINYINT(3), Optional.
- **provisioning_mode_learner**: TINYINT(3), Optional.
- **role_instructor**: BIGINT(19), Nullable.
- **role_learner**: BIGINT(19), Nullable.
- **secret**: LONGTEXT(2147483647), Optional.
- **time_created**: BIGINT(19), Nullable.
- **time_modified**: BIGINT(19), Nullable.
- **time_zone**: VARCHAR(100), Default '99'.
- **uuid**: VARCHAR(36), Optional.

### Table: enrol_lti_user_resource_link

This table maps users to resource links as this is a many-to-many relationship.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **lti_user_id**: BIGINT(19), Nullable, The id of the enrol_lti_users record.
- **resource_link_id**: BIGINT(19), Nullable, The id of the enrol_lti_resource_link record.

### Table: enrol_lti_users

This table stores user access log and gradeback data.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **consumer_key**: LONGTEXT(2147483647), Optional.
- **consumer_secret**: LONGTEXT(2147483647), Optional.
- **last_access**: BIGINT(19), Optional, The time the user last accessed.
- **last_grade**: DECIMAL(10), Optional, The last grade that was sent.
- **lti_deployment_id**: BIGINT(19), Optional.
- **memberships_id**: LONGTEXT(2147483647), Optional.
- **memberships_url**: LONGTEXT(2147483647), Optional.
- **service_url**: LONGTEXT(2147483647), Optional.
- **source_id**: LONGTEXT(2147483647), Optional.
- **time_created**: BIGINT(19), Optional, The time the user was created.
- **tool_id**: BIGINT(19), Nullable.
- **user_id**: BIGINT(19), Nullable.

### Table: enrol_paypal

This table stores all known information about PayPal transactions.

#### Fields

- **id**: BIGINT(19), Primary Key, Nullable.
- **business**: VARCHAR(255), Mandatory.
- **course_id**: BIGINT(19), Default 0.
- **instance_id**: BIGINT(19), Default 0.
- **item_name**: VARCHAR(255), Mandatory.
- **memo**: VARCHAR(255), Mandatory.
- **option_name1**: VARCHAR(255), Mandatory.
- **option_name2**: VARCHAR(255), Mandatory.
- **option_selection1_x**: VARCHAR(255), Mandatory.
- **option_selection2_x**: VARCHAR(255), Mandatory.
- **parent_txn_id**: VARCHAR(255), Mandatory.
- **payment_status**: VARCHAR(255), Mandatory.
- **payment_type**: VARCHAR(30), Mandatory.
- **pending_reason**: VARCHAR(255), Mandatory.
- **reason_code**: VARCHAR(30), Mandatory.
- **receiver_email**: VARCHAR(255), Mandatory.
- **receiver_id**: VARCHAR(255), Mandatory.
- **tax**: VARCHAR(255), Mandatory.
- **time_updated**: BIGINT(19), Default 0.
- **txn_id**: VARCHAR(255), Mandatory.
- **user_id**: BIGINT(19), Default 0.
